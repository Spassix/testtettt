async function initDashboard(){await loadStats(),setupDashboardUI()}async function loadStats(){const products=await BackendData.loadData("products"),categories=await BackendData.loadData("categories"),farms=await BackendData.loadData("farms"),users=await BackendData.loadData("admin_users"),reviews=await BackendData.loadData("reviews"),messages=await BackendData.loadData("messages");document.getElementById("statProducts").textContent=products.length||0,document.getElementById("statCategories").textContent=categories.length||0,document.getElementById("statFarms").textContent=farms.length||0,document.getElementById("statUsers").textContent=users.length||0;const pendingReviews=reviews.filter(r=>"pending"===r.status).length,unreadMessages=messages.filter(m=>!m.read).length;updateStatCard("statPendingReviews",pendingReviews,"Avis en attente","pending_reviews"),updateStatCard("statUnreadMessages",unreadMessages,"Messages non lus","unread_messages"),drawSparkline("sparklineProducts",products.length||0),drawSparkline("sparklineCategories",categories.length||0),drawSparkline("sparklineFarms",farms.length||0),drawSparkline("sparklineUsers",users.length||0),drawSparkline("sparklinePendingReviews",pendingReviews||0),drawSparkline("sparklineUnreadMessages",unreadMessages||0)}function updateStatCard(id,value,label,iconClass){let card=document.getElementById(id);if(!card){const statsGrid=document.querySelector(".stats-grid");if(!statsGrid)return;card=document.createElement("div"),card.className="stat-card",card.id=id;const iconMap={pending_reviews:"pending_actions",unread_messages:"mail"};card.innerHTML=`\n      <div class="stat-icon ${iconClass}">\n        <i class="material-icons">${iconMap[iconClass]||"info"}</i>\n      </div>\n      <div class="stat-info">\n        <div class="stat-value" id="${id}Value">0</div>\n        <div class="stat-label">${label}</div>\n      </div>\n      <div class="stat-sparkline" id="sparkline${id.charAt(0).toUpperCase()+id.slice(1)}"></div>\n    `,statsGrid.appendChild(card),addStatIconStyles()}const valueEl=document.getElementById(id+"Value")||card.querySelector(".stat-value");valueEl&&(valueEl.textContent=value||0)}function addStatIconStyles(){if(document.getElementById("stat-icon-custom-styles"))return;const style=document.createElement("style");style.id="stat-icon-custom-styles",style.textContent="\n    .stat-icon.pending_reviews {\n      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%);\n      color: #fbbf24;\n      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);\n    }\n    .stat-card:hover .stat-icon.pending_reviews {\n      transform: scale(1.1) rotate(5deg);\n    }\n    .stat-icon.unread_messages {\n      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%);\n      color: #a78bfa;\n      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);\n    }\n    .stat-card:hover .stat-icon.unread_messages {\n      transform: scale(1.1) rotate(5deg);\n    }\n  ",document.head.appendChild(style)}function drawSparkline(id,value){const el=document.getElementById(id);if(!el)return;const width=value/Math.max(value,10)*100;el.innerHTML=`\n    <svg width="60" height="30" style="display: block;">\n      <rect x="0" y="10" width="${width}" height="10" fill="var(--primary)" rx="2"></rect>\n    </svg>\n  `}function setupDashboardUI(){const reloadBtn=document.getElementById("reloadDashboardBtn");reloadBtn&&reloadBtn.addEventListener("click",async()=>{await loadStats(),AdminUtils.showToast("Dashboard rechargé","success")});const testDataBtn=document.getElementById("createTestDataBtn");testDataBtn&&testDataBtn.addEventListener("click",async()=>{AdminUtils.confirmAction("Créer des données de test? Les données existantes seront conservées.")&&(await createTestData(),await loadStats(),AdminUtils.showToast("Données de test créées","success"))})}async function createTestData(){if(0===(await BackendData.loadData("products")).length){const testProducts=[{id:Date.now()+1,name:"Produit Test 1",category:"cat1",farm:"",price:25.5,unit:"g",grammages:"10,20,50",customPrices:"10:25,20:45,50:100",media:"",description:"Description de test",featured:!1,createdAt:(new Date).toISOString()}];await BackendData.saveData("products",testProducts)}if(0===(await BackendData.loadData("categories")).length){const testCategories=[{id:Date.now()+2,name:"Catégorie Test",createdAt:(new Date).toISOString()}];await BackendData.saveData("categories",testCategories)}if(0===(await BackendData.loadData("farms")).length){const testFarms=[{id:Date.now()+3,name:"Farm Test",createdAt:(new Date).toISOString()}];await BackendData.saveData("farms",testFarms)}}window.Dashboard={initDashboard:initDashboard,loadStats:loadStats};