let notifications=[],unreadCount=0;async function initNotifications(){localStorage.getItem("notifications_init")||(addNotification("Bienvenue dans le panel admin!","success"),addNotification("N'oubliez pas de configurer votre backend API","warning"),localStorage.setItem("notifications_init","true")),loadNotifications(),setupNotificationsUI()}function addNotification(message,type="info",persistent=!1){const notification={id:Date.now()+Math.random(),message:message,type:type,read:!1,persistent:persistent,createdAt:(new Date).toISOString()};return notifications.unshift(notification),persistent||unreadCount++,updateNotificationsUI(),saveNotifications(),persistent||setTimeout(()=>{removeNotification(notification.id)},5e3),notification.id}function removeNotification(id){const index=notifications.findIndex(n=>n.id===id);index>-1&&(notifications.splice(index,1),updateNotificationsUI(),saveNotifications())}function markAsRead(id){const notification=notifications.find(n=>n.id===id);notification&&!notification.read&&(notification.read=!0,unreadCount=Math.max(0,unreadCount-1),updateNotificationsUI(),saveNotifications())}function markAllAsRead(){notifications.forEach(n=>{n.read||(n.read=!0)}),unreadCount=0,updateNotificationsUI(),saveNotifications()}function loadNotifications(){const stored=localStorage.getItem("admin_notifications");stored&&(notifications=JSON.parse(stored),unreadCount=notifications.filter(n=>!n.read).length)}function saveNotifications(){localStorage.setItem("admin_notifications",JSON.stringify(notifications))}function updateNotificationsUI(){const badge=document.getElementById("notificationBadge");badge&&(badge.textContent=unreadCount>0?unreadCount:"0",badge.style.display=unreadCount>0?"flex":"none");const list=document.getElementById("notificationsList");list&&(0!==notifications.length?(list.innerHTML=notifications.map(n=>`\n    <div class="notification-item ${n.read?"":"unread"}" data-id="${n.id}">\n      <div style="display: flex; justify-content: space-between; align-items: start;">\n        <div>\n          <div style="font-weight: 600; margin-bottom: 0.25rem;">${AdminUtils.escapeHtml(n.message)}</div>\n          <div style="font-size: 0.85rem; color: var(--text-secondary);">${AdminUtils.formatDate(n.createdAt)}</div>\n        </div>\n        ${n.read?"":'<span style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%;"></span>'}\n      </div>\n    </div>\n  `).join(""),list.querySelectorAll(".notification-item").forEach(item=>{item.addEventListener("click",()=>{markAsRead(parseFloat(item.dataset.id))})})):list.innerHTML='<div style="padding: 2rem; text-align: center; color: var(--text-secondary);">Aucune notification</div>')}function setupNotificationsUI(){const btn=document.getElementById("notificationsBtn"),panel=document.getElementById("notificationsPanel"),markAllBtn=document.getElementById("markAllReadBtn");btn&&panel&&btn.addEventListener("click",e=>{e.stopPropagation(),panel.classList.toggle("hidden"),updateNotificationsUI()}),markAllBtn&&markAllBtn.addEventListener("click",()=>{markAllAsRead()}),document.addEventListener("click",e=>{!panel||panel.contains(e.target)||btn.contains(e.target)||panel.classList.add("hidden")});const userMenu=document.getElementById("userMenu"),userDropdown=document.getElementById("userDropdown");userMenu&&userDropdown&&userMenu.addEventListener("click",e=>{e.stopPropagation(),userDropdown.classList.toggle("hidden")}),document.addEventListener("click",e=>{!userDropdown||userDropdown.contains(e.target)||userMenu.contains(e.target)||userDropdown.classList.add("hidden")}),updateNotificationsUI()}window.Notifications={addNotification:addNotification,removeNotification:removeNotification,markAsRead:markAsRead,markAllAsRead:markAllAsRead,initNotifications:initNotifications},document.addEventListener("DOMContentLoaded",()=>{initNotifications()});