class ModalManager{constructor(){this.activeModal=null,this.setupGlobalHandlers()}setupGlobalHandlers(){document.addEventListener("click",e=>{e.target.classList.contains("modal-overlay")&&this.closeAll()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.activeModal&&this.closeAll()}),document.addEventListener("click",e=>{this.activeModal&&this.activeModal.contains(e.target)&&e.stopPropagation()})}open(modalId){const modal=document.getElementById(modalId),overlay=document.getElementById("modalOverlay");if(!modal)return void console.error(`Modal ${modalId} not found`);this.activeModal&&this.activeModal!==modal&&this.close(this.activeModal.id),this.activeModal=modal,modal.classList.remove("hidden"),overlay&&overlay.classList.remove("hidden");const firstInput=modal.querySelector("input, select, textarea");firstInput&&setTimeout(()=>{firstInput.focus(),firstInput.select&&firstInput.select()},150),document.body.style.overflow="hidden",requestAnimationFrame(()=>{modal.style.opacity="0",modal.style.transform="scale(0.95)",requestAnimationFrame(()=>{modal.style.transition="all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",modal.style.opacity="1",modal.style.transform="scale(1)"})})}close(modalId){const modal=modalId?document.getElementById(modalId):this.activeModal,overlay=document.getElementById("modalOverlay");modal&&(modal.style.transition="all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",modal.style.opacity="0",modal.style.transform="scale(0.95)",setTimeout(()=>{modal.classList.add("hidden"),modal.style.opacity="",modal.style.transform=""},200)),overlay&&(overlay.style.opacity="0",setTimeout(()=>{overlay.classList.add("hidden"),overlay.style.opacity=""},200)),this.activeModal===modal&&(this.activeModal=null),document.body.style.overflow=""}closeAll(){this.activeModal&&this.close(this.activeModal.id),document.querySelectorAll(".modal").forEach(m=>{m.classList.add("hidden"),m.style.opacity="",m.style.transform=""});const overlay=document.getElementById("modalOverlay");overlay&&(overlay.classList.add("hidden"),overlay.style.opacity=""),document.body.style.overflow=""}setupModal(modalId,onSave,onCancel=null){const modal=document.getElementById(modalId);if(!modal)return void console.warn(`Modal ${modalId} not found for setup`);const saveBtn=modal.querySelector('[id$="ModalSave"]'),cancelBtn=modal.querySelector('[id$="ModalCancel"]'),closeBtn=modal.querySelector('[id$="ModalClose"]'),form=modal.querySelector("form");form&&form.addEventListener("submit",e=>{e.preventDefault(),onSave&&!1!==onSave()&&this.close(modalId)}),saveBtn&&(saveBtn.onclick=e=>{e.preventDefault(),onSave&&!1!==onSave()&&this.close(modalId)}),cancelBtn&&(cancelBtn.onclick=e=>{e.preventDefault(),onCancel&&onCancel(),this.close(modalId)}),closeBtn&&(closeBtn.onclick=e=>{e.preventDefault(),onCancel&&onCancel(),this.close(modalId)})}}function resetForm(formId){const form=document.getElementById(formId);form&&(form.reset(),form.querySelectorAll("[data-editing-id]").forEach(el=>{el.removeAttribute("data-editing-id")}),form.querySelectorAll(":invalid").forEach(el=>{el.classList.remove("error")}))}window.modalManager=new ModalManager,window.resetForm=resetForm;