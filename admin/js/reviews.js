async function initReviews(){await loadReviews(),setupReviewsUI()}async function loadReviews(){renderReviews(await BackendData.loadData("reviews"))}function renderReviews(reviews){const list=document.getElementById("adminReviewsList");if(!list)return;if(0===reviews.length)return void(list.innerHTML='<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">Aucun avis en attente</div>');const pending=reviews.filter(r=>"pending"===r.status),approved=reviews.filter(r=>"approved"===r.status),rejected=reviews.filter(r=>"rejected"===r.status);let html="";pending.length>0&&(html+='<div style="margin-bottom: 2rem;"><h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.2rem;">En attente ('+pending.length+")</h3>",html+=pending.map(review=>renderReviewCard(review)).join(""),html+="</div>"),approved.length>0&&(html+='<div style="margin-bottom: 2rem;"><h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.2rem;">Approuvés ('+approved.length+")</h3>",html+=approved.map(review=>renderReviewCard(review)).join(""),html+="</div>"),rejected.length>0&&(html+='<div style="margin-bottom: 2rem;"><h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.2rem;">Rejetés ('+rejected.length+")</h3>",html+=rejected.map(review=>renderReviewCard(review)).join(""),html+="</div>"),list.innerHTML=html,setupReviewActions()}function renderReviewCard(review){const date=new Date(review.createdAt).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),stars=Array.from({length:5},(_,i)=>{const filled=i<review.rating;return`<i class="material-icons" style="font-size: 1.2rem; color: ${filled?"#ffd700":"rgba(255,255,255,0.3)"}">${filled?"star":"star_border"}</i>`}).join(""),photoHtml=review.photo?`\n    <div style="margin-top: 0.75rem; margin-bottom: 0.75rem;">\n      <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">Photo :</div>\n      <img src="${review.photo}" alt="Photo avis" \n           style="max-width: 100%; max-height: 400px; border-radius: 12px; margin-top: 0.5rem; \n                  border: 2px solid rgba(255,255,255,0.1); cursor: pointer; \n                  object-fit: contain; background: rgba(0,0,0,0.3);"\n           onclick="window.open('${review.photo}', '_blank')"\n           onerror="this.style.display='none';">\n    </div>\n  `:"",statusBadge={pending:'<span style="background: #fbbf24; color: #000; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">En attente</span>',approved:'<span style="background: #10b981; color: #fff; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">Approuvé</span>',rejected:'<span style="background: #ef4444; color: #fff; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">Rejeté</span>'}[review.status]||"";return`\n    <div class="list-item" data-review-id="${review.id}">\n      <div class="list-item-info" style="flex: 1;">\n        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">\n          <div class="list-item-title">${AdminUtils.escapeHtml(review.author||"Anonyme")}</div>\n          ${statusBadge}\n        </div>\n        <div style="margin-bottom: 0.5rem;">\n          ${stars}\n        </div>\n        <div class="list-item-meta" style="margin-bottom: 0.75rem; color: var(--text-secondary);">\n          ${AdminUtils.escapeHtml(review.description)}\n        </div>\n        ${photoHtml}\n        <div class="list-item-meta" style="margin-top: 0.5rem; color: var(--text-muted); font-size: 0.85rem;">\n          ${date}\n        </div>\n      </div>\n      <div class="list-item-actions">\n        ${"pending"===review.status?`\n          <button class="btn-primary btn-small" onclick="approveReview(${review.id})">\n            <i class="material-icons" style="font-size: 18px;">check</i> Valider\n          </button>\n          <button class="btn-danger btn-small" onclick="rejectReview(${review.id})">\n            <i class="material-icons" style="font-size: 18px;">close</i> Refuser\n          </button>\n        `:`\n          <button class="btn-secondary btn-small" onclick="deleteReview(${review.id})">\n            <i class="material-icons" style="font-size: 18px;">delete</i> Supprimer\n          </button>\n        `}\n      </div>\n    </div>\n  `}function setupReviewsUI(){}function setupReviewActions(){}async function approveReview(id){if(!confirm("Voulez-vous approuver cet avis ? Il sera publié sur le site."))return;const reviews=await BackendData.loadData("reviews"),review=reviews.find(r=>r.id===id);review&&(console.log("✅ Approbation avis",id,"- Photo:",review.photo||"aucune"),review.status="approved",review.photo||console.warn("⚠️ Attention: l'avis n'a pas de photo"),await BackendData.saveData("reviews",reviews),window.backendAPI&&window.backendAPI.syncToSite&&window.backendAPI.syncToSite("reviews",reviews),AdminUtils.showToast("Avis approuvé et publié","success"),await loadReviews())}async function rejectReview(id){if(!confirm("Voulez-vous rejeter cet avis ? Il ne sera pas publié."))return;const reviews=await BackendData.loadData("reviews"),review=reviews.find(r=>r.id===id);review&&(review.status="rejected",await BackendData.saveData("reviews",reviews),AdminUtils.showToast("Avis rejeté","info"),await loadReviews())}async function deleteReview(id){if(!confirm("Voulez-vous supprimer définitivement cet avis ?"))return;const filtered=(await BackendData.loadData("reviews")).filter(r=>r.id!==id);await BackendData.saveData("reviews",filtered),AdminUtils.showToast("Avis supprimé","success"),await loadReviews()}window.Reviews={initReviews:initReviews,approveReview:approveReview,rejectReview:rejectReview,deleteReview:deleteReview};