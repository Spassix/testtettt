!function(){"use strict";window.addEventListener("adminDataUpdated",t=>{const{key:e,data:r}=t.detail;h(e,r)}),window.addEventListener("storage",t=>{if(t.key&&t.key.startsWith("site_")){const e=t.key.replace("site_","");try{h(e,JSON.parse(t.newValue))}catch(r){console.error("Erreur parsing localStorage:",r)}}});let E=Date.now();function h(t,e){switch(t){case"categoriesEnabled":b(e);break;case"farmsEnabled":x(e);break;case"typography":v(e);break;case"productModal":S(e);break;case"products":!function(){const t=localStorage.getItem("site_products");if(t)try{const e=JSON.parse(t),r=window.normalizeProducts(e);window.renderProducts(r),r.length}catch(e){console.error("Erreur chargement produits:",e)}}();break;case"categories":!function(){const t=localStorage.getItem("site_categories");if(t)try{const e=JSON.parse(t);w(e),e.length}catch(e){console.error("Erreur chargement cat√©gories:",e)}}();break;case"farms":!function(){const t=localStorage.getItem("site_farms");if(t)try{const e=JSON.parse(t);_(e),e.length}catch(e){console.error("Erreur chargement farms:",e)}}();break;case"config":I(e),k();break;case"banner":B(e);break;case"loadingscreen":case"payments":break;case"socials":!function(){const t=localStorage.getItem("site_socials");if(t)try{const e=JSON.parse(t);f(e),e.length}catch(e){console.error("Erreur chargement r√©seaux sociaux:",e)}else f([])}();break;case"promos":T();break;case"maintenance":$(e);break;case"cart_services":N(e);break;case"cart_options":q(e);break;case"cart_slots":p(e)}}function b(t){const e=document.querySelector(".filter-row:has(#filterCategory)"),r=document.getElementById("filterCategory");e&&(e.style.display=t?"":"none"),!t&&r&&(r.value="tous")}function x(t){const e=document.querySelector(".filter-row:has(#filterFarm)"),r=document.getElementById("filterFarm");e&&(e.style.display=t?"":"none"),!t&&r&&(r.value="")}function v(t){const e=t.customFamily||t.family||"Inter",r=t.size||16;!t.customFamily&&t.family&&function(t){const e=document.createElement("link");e.href=`https://fonts.googleapis.com/css2?family=${t.replace(" ","+")}:wght@400;600;700&display=swap`,e.rel="stylesheet",document.querySelector(`link[href*="${t}"]`)||document.head.appendChild(e)}(t.family),document.documentElement.style.setProperty("--font-family","'"+e+"', sans-serif"),document.documentElement.style.setProperty("--font-size",String(r)+"px"),document.body.style.fontFamily="'"+e+"', sans-serif",document.body.style.fontSize=String(r)+"px"}function S(t){const e=document.createElement("style");e.id="productModalConfig";const r=(t.overlayOpacity||80)/100;e.textContent=`\n      .product-modal {\n        background: rgba(0,0,0,${r}) !important;\n      }\n      .pm-wrap {\n        background: linear-gradient(135deg, ${t.bgColor||"#1a1a2e"} 0%, ${function(t){const r=t.replace("#",""),o=Math.max(0,Math.min(255,parseInt(r.substr(0,2),16)+-20)),s=Math.max(0,Math.min(255,parseInt(r.substr(2,2),16)+-20)),a=Math.max(0,Math.min(255,parseInt(r.substr(4,2),16)+-20));return`#${o.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}`}(t.bgColor||"#1a1a2e")} 100%) !important;\n        border-color: ${t.borderColor||"#6366f1"} !important;\n        border-radius: ${t.borderRadius||24}px !important;\n      }\n      .pm-wrap::before {\n        border-color: ${t.borderColor||"#6366f1"} !important;\n      }\n      .pm-panel h2 {\n        color: ${t.titleColor||"#ffffff"} !important;\n      }\n      .pm-pricebar > div:last-child {\n        color: ${t.priceColor||"#ffffff"} !important;\n      }\n      .pm-panel p, .pm-info {\n        color: ${t.textColor||"#cccccc"} !important;\n      }\n      .pm-primary {\n        background: ${t.btnBgColor||"#6366f1"} !important;\n        color: ${t.btnTextColor||"#ffffff"} !important;\n      }\n      #pmVideo {\n        ${t.showVideoControls?"":"pointer-events: none;"}\n      }\n      .pm-tags {\n        ${t.showTags?"":"display: none !important;"}\n      }\n    `;const o=document.getElementById("productModalConfig");o&&o.remove(),document.head.appendChild(e);const s=document.getElementById("pmAdd");s&&t.btnText&&(s.textContent=t.btnText)}function w(t){const e=document.getElementById("filterCategory");if(!e)return;const r=e.value;e.innerHTML='<option value="tous">Toutes les cat√©gories</option>',t.forEach(o=>{const s=document.createElement("option");s.value=o.name||"",s.textContent=o.name||"",e.appendChild(s)}),r&&(e.value=r),function(t){const e=document.querySelector(".nav-items");e&&(e.innerHTML='\n      <button class="nav-item" data-category="tous">\n        <i class="material-icons">dashboard</i>\n        <span>Toutes les cat√©gories</span>\n      </button>\n    ',t.forEach(r=>{const o=document.createElement("button");o.className="nav-item",o.setAttribute("data-category",r.name||""),o.innerHTML=`\n        <i class="material-icons">category</i>\n        <span>${r.name||""}</span>\n      `,e.appendChild(o)}),e&&e.dispatchEvent(new Event("DOMNodeInserted")))}(t)}function f(t){const e=document.querySelector(".contact-list");if(!e)return;if(!t||0===t.length)return void(e.innerHTML='<div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.5);">Aucun r√©seau social configur√©</div>');const r={Instagram:"photo_camera",TikTok:"music_note",Snapchat:"camera_alt",Telegram:"send",WhatsApp:"chat",Facebook:"facebook",Twitter:"chat_bubble",YouTube:"play_circle",Autre:"link"};e.innerHTML=t.map(o=>{const s=r[o.name]||"link";return`\n        <a href="${o.url||"#"}" target="_blank" rel="noopener noreferrer" class="contact-item">\n          <div class="ci-left">\n            <i class="material-icons">${s}</i>\n            <span>${o.name||"R√©seau social"}</span>\n          </div>\n          <i class="material-icons">open_in_new</i>\n        </a>\n      `}).join("")}function _(t){const e=document.getElementById("filterFarm");if(!e)return;const r=e.value;e.innerHTML='<option value="">Toutes les farms</option>',t.forEach(o=>{const s=document.createElement("option");s.value=o.name||"",s.textContent=o.name||"",e.appendChild(s)}),r&&(e.value=r)}function I(t){t.siteBackground?document.body.style.backgroundImage=`url(${t.siteBackground})`:document.body.style.backgroundImage="";const r=document.querySelector(".hero-intro");if(r&&(r.textContent=t.heroTitle||""),t.heroBrand){const e=document.querySelector(".hero-brand");e&&(e.textContent=t.heroBrand)}if(t.heroSubtitle){const e=document.querySelector(".hero-subtitle");e&&(e.textContent=t.heroSubtitle)}if(t.shopName){const e=document.querySelector(".logo-text h1");e&&(e.textContent=t.shopName);const o=document.querySelector("title");o&&(o.textContent=`${t.shopName} - Boutique en ligne`)}if(void 0!==t.shopTagline){const e=document.querySelector(".logo-text .tagline");e&&(e.textContent=t.shopTagline||"")}(function(t){const e=document.getElementById("cartBannerWrapper"),r=document.getElementById("cartBannerImage"),o=document.getElementById("cartBannerImg");if(e&&r&&(t?(r.src=t,r.alt="Banni√®re du panier",r.loading="lazy",e.style.display="block"):(r.removeAttribute("src"),e.style.display="none")),o){for(;o.firstChild;)o.removeChild(o.firstChild);if(t){const s=document.createElement("img");s.src=t,s.alt="Banni√®re du panier",s.loading="lazy",o.appendChild(s),o.style.display="block"}else o.style.display="none"}})(t.cartBanner),t.siteBackground,t.heroTitle,t.heroBrand,t.heroSubtitle,t.shopName,t.shopTagline}function B(t){let e=document.querySelector(".scroll-banner");if(!e){e=document.createElement("div"),e.className="scroll-banner",e.id="scrollBanner",e.setAttribute("aria-label","Annonce"),e.innerHTML='\n        <div class="scroll-track" id="scrollTrack">\n          <span class="scroll-item" id="scrollItemA"></span>\n          <span class="scroll-item" id="scrollItemB" aria-hidden="true"></span>\n        </div>\n      ';const a=document.querySelector(".header");a?a.nextElementSibling?a.parentNode.insertBefore(e,a.nextElementSibling):a.parentNode.appendChild(e):document.body.insertBefore(e,document.body.firstChild)}const r=document.getElementById("scrollItemA"),o=document.getElementById("scrollItemB"),s=t.text&&t.text.trim()?t.text.trim():"";r&&(r.textContent=s),o&&(o.textContent=s),t.enabled&&s?e.style.display="block":(e.style.display="none",t.enabled)}function k(){const t=localStorage.getItem("site_config");if(t)try{const e=JSON.parse(t);e.servicesButtons&&Array.isArray(e.servicesButtons)&&(function(t){const e=document.getElementById("homeServices");e&&(e.innerHTML="",t.forEach(r=>{if(!r.text||!r.text.trim())return;const o=document.createElement("div");o.style.cssText="width: 92%; max-width: 820px; margin: 1.5rem auto;",o.className="services-card";const s=`servicesButton_${r.id}`,a=`servicesContent_${r.id}`;o.innerHTML=`\n        <button id="${s}" class="services-button" aria-expanded="false">\n          <div class="services-icon-container">\n            <span class="services-icon">${r.icon||"üåø"}</span>\n          </div>\n          <span class="services-label">${r.title||"SERVICES"}</span>\n          <i class="material-icons services-chevron">keyboard_arrow_down</i>\n        </button>\n        <div id="${a}" class="services-content">\n          <div class="services-text"></div>\n        </div>\n      `,e.appendChild(o);const i=document.getElementById(s),n=document.getElementById(a);n.style.maxHeight="0",n.style.overflow="hidden",n.style.paddingTop="0",n.style.paddingBottom="0",n.style.paddingLeft="0",n.style.paddingRight="0",n.style.marginTop="0",n.style.marginBottom="0",n.style.opacity="0";const d=n.querySelector(".services-text");if(d&&r.text){const u=r.text.split("\n").filter(m=>m.trim()).map(m=>`<p style="margin: 0.5rem 0; line-height: 1.6;">${m.trim()}</p>`).join("");d.innerHTML=u}i.addEventListener("click",function(u){u.stopPropagation(),u.preventDefault();const m="true"!==i.getAttribute("aria-expanded");if(i.setAttribute("aria-expanded",m),m){n.style.maxHeight="none";const y=n.scrollHeight;n.style.maxHeight="0",setTimeout(()=>{n.style.maxHeight=y+"px",n.style.paddingTop="1.5rem",n.style.paddingBottom="1.5rem",n.style.paddingLeft="1.25rem",n.style.paddingRight="1.25rem",n.style.marginTop="0.75rem",n.style.marginBottom="2rem",n.style.opacity="1"},10)}else n.style.maxHeight=n.scrollHeight+"px",n.offsetHeight,n.style.maxHeight="0",n.style.paddingTop="0",n.style.paddingBottom="0",n.style.paddingLeft="0",n.style.paddingRight="0",n.style.marginTop="0",n.style.marginBottom="0",n.style.opacity="0";const g=i.querySelector(".services-chevron");g&&(g.textContent=m?"keyboard_arrow_up":"keyboard_arrow_down")})}))}(e.servicesButtons),e.servicesButtons.length)}catch(e){console.error("Erreur chargement boutons SERVICES:",e)}}function T(){const t=localStorage.getItem("site_promos");if(t)try{const e=JSON.parse(t);window.availablePromos=e||[],e.length}catch(e){console.error("Erreur chargement promos:",e),window.availablePromos=[]}else window.availablePromos=[]}function $(t){if(!t||!t.enabled){const r=document.getElementById("maintenanceOverlay");return void(r&&r.remove())}let e=document.getElementById("maintenanceOverlay");e||(e=document.createElement("div"),e.id="maintenanceOverlay",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.95);\n        z-index: 99999;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-direction: column;\n        padding: 2rem;\n        text-align: center;\n      ",document.body.appendChild(e)),e.innerHTML=`\n      <div style="max-width: 500px; color: #fff;">\n        <h1 style="font-size: 2.5rem; margin-bottom: 1rem; color: #fff;">üöß</h1>\n        <h2 style="font-size: 1.8rem; margin-bottom: 1.5rem; color: #fff;">Site en maintenance</h2>\n        <p style="font-size: 1.1rem; line-height: 1.6; color: rgba(255, 255, 255, 0.9);">\n          ${t.message||"Site en maintenance, veuillez r√©essayer plus tard..."}\n        </p>\n      </div>\n    `,t.message}function N(t){const e=document.querySelector(".service-list");if(!e)return;const r=t||{home:!0,postal:!0,meet:!0},o=e.querySelector('[data-service="home"]'),s=e.querySelector('[data-service="postal"]'),a=e.querySelector('[data-service="meet"]');o&&(o.style.display=!1!==r.home?"":"none"),s&&(s.style.display=!1!==r.postal?"":"none"),a&&(a.style.display=!1!==r.meet?"":"none")}function q(t){const e=document.getElementById("horaireOptions");if(!e||!t||!Array.isArray(t)||0===t.length)return;const r=t.filter(o=>!1!==o.enabled);0!==r.length?(e.innerHTML=r.map(o=>`<button class="option-btn" data-horaire="${o.id||o.value||o.name}">${o.label||o.name||o.value}</button>`).join(""),e.querySelectorAll(".option-btn").forEach(o=>{o.addEventListener("click",function(){e.querySelectorAll(".option-btn").forEach(a=>a.classList.remove("active")),this.classList.add("active");const s=document.getElementById("recapHoraire");s&&(s.textContent=this.textContent)})}),r.length):e.innerHTML='<p style="color: rgba(255,255,255,0.5); text-align: center;">Aucune option disponible</p>'}function M(){setTimeout(()=>{!function(){const t=localStorage.getItem("site_categoriesEnabled"),e=localStorage.getItem("site_farmsEnabled"),r=localStorage.getItem("site_typography"),o=localStorage.getItem("site_productModal"),s=localStorage.getItem("site_banner"),a=localStorage.getItem("site_config"),i=localStorage.getItem("site_loadingscreen"),n=localStorage.getItem("site_products"),d=localStorage.getItem("site_categories"),u=localStorage.getItem("site_farms"),m=localStorage.getItem("site_payments"),g=localStorage.getItem("site_socials");if(null!==t&&b(JSON.parse(t)),null!==e&&x(JSON.parse(e)),r)try{v(JSON.parse(r))}catch(c){console.error("Erreur typographie:",c)}if(o)try{S(JSON.parse(o))}catch(c){console.error("Erreur product modal:",c)}if(s)try{B(JSON.parse(s))}catch(c){console.error("Erreur banner:",c)}if(a)try{I(JSON.parse(a))}catch(c){console.error("Erreur config:",c)}if(i)try{JSON.parse(i)}catch(c){console.error("Erreur loading screen:",c)}if(n)try{const c=JSON.parse(n),G=window.normalizeProducts(c);window.renderProducts(G)}catch(c){console.error("Erreur produits:",c)}if(d)try{w(JSON.parse(d))}catch(c){console.error("Erreur cat√©gories:",c)}if(u)try{_(JSON.parse(u))}catch(c){console.error("Erreur farms:",c)}if(m)try{JSON.parse(m).length,setTimeout(()=>{window.loadPaymentMethods&&window.loadPaymentMethods()},200)}catch(c){console.error("Erreur chargement payments:",c)}if(g)try{const c=JSON.parse(g);f(c),c.length}catch(c){console.error("Erreur chargement r√©seaux sociaux:",c)}else f([]);k(),T();const y=localStorage.getItem("site_maintenance");if(y)try{$(JSON.parse(y))}catch(c){console.error("Erreur maintenance:",c)}const O=localStorage.getItem("site_cart_services");if(O)try{N(JSON.parse(O))}catch(c){console.error("Erreur cart services:",c)}const P=localStorage.getItem("site_cart_options");if(P)try{q(JSON.parse(P))}catch(c){console.error("Erreur cart options:",c)}const A=localStorage.getItem("site_cart_slots");if(A)try{p(JSON.parse(A))}catch(c){console.error("Erreur cart slots:",c)}}()},100)}setInterval(()=>{["site_banner","site_config","site_typography","site_productModal","site_categoriesEnabled","site_farmsEnabled","site_loadingscreen","site_products","site_categories","site_farms","site_payments","site_socials","site_promos","site_maintenance","site_cart_services","site_cart_options","site_cart_slots","site_messages"].forEach(t=>{const e=t,r=localStorage.getItem(e);if(r){const o=localStorage.getItem(`${e}_timestamp`);if(o&&parseInt(o)>E)try{const s=JSON.parse(r);h(t.replace("site_",""),s)}catch(s){console.error("Erreur polling:",s)}}}),E=Date.now()},1e3),window.normalizeProducts=function(t){if(!Array.isArray(t))return t;function e(r){return r&&r.replace(/^\d+/,"").trim()||"g"}return t.map(r=>{const o=e(r.unit||"g"),s={};if(r.customPrices&&r.customPrices.split(",").forEach(i=>{const[n,d]=i.trim().split(":").map(u=>u.trim());n&&d&&!isNaN(parseFloat(n))&&!isNaN(parseFloat(d))&&(s[parseFloat(n)]=parseFloat(d))}),r.quantities&&Array.isArray(r.quantities)&&r.quantities.length>0){if(r.quantities.some(i=>{const n=void 0!==s[i.grammage]?s[i.grammage]:(r.price||0)*i.grammage;return Math.abs(i.price-n)>.01})||r.grammages){const i=r.quantities.map(n=>{const d=void 0!==s[n.grammage]?s[n.grammage]:(r.price||0)*n.grammage;return{...n,unit:e(n.unit||o),price:d}});return{...r,unit:o,quantities:i}}return{...r,unit:o,quantities:r.quantities.map(i=>({...i,unit:e(i.unit||o)}))}}let a=[];if(r.grammages){const i=r.grammages.split(",").map(n=>n.trim()).filter(n=>n&&!isNaN(parseFloat(n))).map(n=>parseFloat(n));i.length>0?(a=i.map(n=>({grammage:n,unit:o,price:void 0!==s[n]?s[n]:(r.price||0)*n})),Object.keys(s).forEach(n=>{const d=parseFloat(n);!i.includes(d)&&!isNaN(d)&&a.push({grammage:d,unit:o,price:s[d]})}),a.sort((n,d)=>n.grammage-d.grammage)):r.price&&r.price>0&&(a=[{grammage:1,unit:r.unit||"g",price:r.price}])}return{...r,unit:o,quantities:a.length>0?a:void 0}})},window.renderProducts=function(t){const e=document.getElementById("productsGrid");if(!e)return;if(!t||0===t.length)return void(e.innerHTML='<div class="empty-state">Aucun produit disponible</div>');const r=window.normalizeProducts(t),o=new Map;r.forEach((a,i)=>{const n=(a.category||"Sans cat√©gorie").toString();o.has(n)||o.set(n,i)});const s=r.map((a,i)=>({p:a,idx:i})).sort((a,i)=>{const n=o.get((a.p.category||"Sans cat√©gorie").toString()),d=o.get((i.p.category||"Sans cat√©gorie").toString());return n!==d?n-d:a.idx-i.idx}).map(a=>a.p);e.innerHTML=s.map(a=>{const i=a.photo||a.image||a.media||"";let d=a.price?a.price.toFixed(2):"0.00";return a.quantities&&a.quantities.length>0&&(d=Math.min(...a.quantities.map(u=>u.price)).toFixed(2)),`\n        <div class="product-card" data-product-id="${a.id||""}" onclick="openProduct(${a.id||0})">\n          ${i?`\n            <div class="product-media">\n              <img src="${i}" alt="${a.name||""}" />\n            </div>\n          `:""}\n          <div class="product-info">\n            <h3>${a.name||"Produit"}</h3>\n            <div class="product-tags">\n              ${a.category?`<span class="product-category">${a.category}</span>`:""}\n              ${a.farm?`<span class="product-farm">${a.farm}</span>`:""}\n              ${a.featured?'<span class="product-badge-tag">‚≠ê En vedette</span>':""}\n            </div>\n            <div class="product-price">${d}‚Ç¨</div>\n          </div>\n        </div>\n      `}).join("")},window.openProduct=function(t){const e=localStorage.getItem("site_products");if(e)try{const r=JSON.parse(e),o=window.normalizeProducts(r).find(s=>s.id===t||s.id===parseInt(t));if(!o)return void console.warn("Produit non trouv√©:",t);window.showProductModal?window.showProductModal(o):(console.warn("showProductModal non disponible - chargement du script..."),setTimeout(()=>{window.showProductModal&&window.showProductModal(o)},100))}catch(r){console.error("Erreur ouverture produit:",r)}else console.warn("Aucun produit trouv√© dans localStorage")},window.filterProductsByCategory=function(t){const e=localStorage.getItem("site_products");if(e)try{const r=JSON.parse(e),o=window.normalizeProducts(r),s="tous"===t?o:o.filter(a=>a.category===t);window.renderProducts(s)}catch(r){console.error("Erreur filtrage produits:",r)}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",M):M(),console.log("‚úÖ Syst√®me de synchronisation admin charg√©")}();