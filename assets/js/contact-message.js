!function(){"use strict";function addContactButton(){const contactList=document.querySelector(".contact-list");if(!contactList)return;if(document.getElementById("contactMessageBtn"))return;const contactButton=document.createElement("button");contactButton.id="contactMessageBtn",contactButton.className="contact-item",contactButton.style.cssText="background: #000 !important; border: 1px solid rgba(255,255,255,0.14); padding: 14px 16px; border-radius: 14px; box-shadow: 0 6px 16px rgba(0,0,0,0.18); cursor: pointer; width: 100%; text-align: left; color: #e7e7e7; font-family: inherit; display: flex; align-items: center; justify-content: space-between;",contactButton.innerHTML='\n      <div class="ci-left">\n        <i class="material-icons" style="color: var(--primary, #ff6d9e);">mail</i>\n        <span style="font-weight: 600;">Envoyer un message</span>\n      </div>\n      <i class="material-icons" style="color: #e7e7e7; opacity: 0.7;">arrow_forward</i>\n    ',contactList.insertBefore(contactButton,contactList.firstChild),contactButton.addEventListener("click",openContactModal)}function resetModal(){const form=document.getElementById("contactMessageForm"),successDiv=document.getElementById("contactMessageSuccess");form&&successDiv&&(form.style.display="block",successDiv.style.display="none",form.reset())}function openContactModal(){let modal=document.getElementById("contactMessageModal");modal||(modal=function(){const modal=document.createElement("div");return modal.id="contactMessageModal",modal.className="product-modal",modal.style.display="none",modal.innerHTML='\n      <div class="pm-wrap" style="grid-template-columns: 1fr; max-width: 500px;">\n        <button class="pm-close" id="contactMessageClose" style="background: rgba(255,255,255,0.15) !important; border: 2px solid rgba(255,255,255,0.3) !important; width: 40px !important; height: 40px !important; border-radius: 50% !important; display: flex !important; align-items: center !important; justify-content: center !important; cursor: pointer !important; transition: all 0.2s !important;">\n          <i class="material-icons" style="color: #fff !important; font-size: 24px !important;">close</i>\n        </button>\n        <div class="pm-panel">\n          <h2 style="margin-bottom: 1.5rem;">Envoyer un message</h2>\n          <div id="contactMessageSuccess" style="display: none; text-align: center; padding: 2rem 1rem;">\n            <div style="width: 80px; height: 80px; margin: 0 auto 1.5rem; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);">\n              <i class="material-icons" style="color: #fff; font-size: 48px;">check_circle</i>\n            </div>\n            <h3 style="color: #fff; font-size: 1.5rem; font-weight: 700; margin-bottom: 0.75rem;">Message envoyé avec succès !</h3>\n            <p style="color: rgba(255,255,255,0.7); font-size: 1rem; margin-bottom: 2rem; line-height: 1.6;">\n              Votre message a bien été envoyé. Nous vous répondrons dès que possible.\n            </p>\n            <button \n              type="button" \n              id="contactMessageCloseAfterSuccess"\n              style="padding: 0.875rem 2rem; border-radius: 12px; border: none; background: var(--primary, #6366f1); color: #fff; cursor: pointer; font-weight: 600; font-size: 1rem; transition: all 0.2s;"\n              onmouseover="this.style.background=\'#4f46e5\'; this.style.transform=\'translateY(-2px)\';"\n              onmouseout="this.style.background=\'var(--primary, #6366f1)\'; this.style.transform=\'translateY(0)\';"\n            >\n              Fermer\n            </button>\n          </div>\n          <form id="contactMessageForm">\n            <div class="form-group" style="margin-bottom: 1.25rem;">\n              <label style="display: block; margin-bottom: 0.5rem; color: var(--text, #e7e7e7); font-weight: 600;">\n                Votre nom d\'utilisateur Telegram *\n              </label>\n              <input \n                type="text" \n                id="contactTelegramUsername" \n                placeholder="@username ou username"\n                required\n                style="width: 100%; padding: 0.875rem 1rem; border-radius: 12px; border: 2px solid rgba(255,255,255,0.1); background: rgba(26,26,26,0.8); color: #fff; font-size: 16px; outline: none;"\n              >\n            </div>\n            <div class="form-group" style="margin-bottom: 1.5rem;">\n              <label style="display: block; margin-bottom: 0.5rem; color: var(--text, #e7e7e7); font-weight: 600;">\n                Votre message *\n              </label>\n              <textarea \n                id="contactMessageText" \n                placeholder="Écrivez votre message ici..."\n                required\n                rows="6"\n                style="width: 100%; padding: 0.875rem 1rem; border-radius: 12px; border: 2px solid rgba(255,255,255,0.1); background: rgba(26,26,26,0.8); color: #fff; font-size: 16px; outline: none; resize: vertical; font-family: inherit;"\n              ></textarea>\n            </div>\n            <div style="display: flex; gap: 1rem; justify-content: space-between; align-items: center; width: 100%; box-sizing: border-box;">\n              <button \n                type="button" \n                class="pm-secondary" \n                id="contactMessageCancel"\n                style="padding: 0.875rem 1.25rem; border-radius: 12px; border: 2px solid rgba(255,255,255,0.4); background: rgba(255,255,255,0.2); color: #fff; cursor: pointer; font-weight: 600; transition: all 0.2s; flex: 1 1 0; min-width: 0; max-width: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.2); box-sizing: border-box;"\n                onmouseover="this.style.background=\'rgba(255,255,255,0.3)\'; this.style.borderColor=\'rgba(255,255,255,0.6)\'; this.style.transform=\'translateY(-1px)\'; this.style.boxShadow=\'0 4px 12px rgba(0,0,0,0.3)\';"\n                onmouseout="this.style.background=\'rgba(255,255,255,0.2)\'; this.style.borderColor=\'rgba(255,255,255,0.4)\'; this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 8px rgba(0,0,0,0.2)\';"\n              >\n                <i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem; font-size: 18px;">arrow_back</i>\n                Annuler\n              </button>\n              <button \n                type="submit" \n                class="pm-primary" \n                id="contactMessageSubmit"\n                style="padding: 0.875rem 1.25rem; border-radius: 12px; border: none; background: var(--primary, #6366f1); color: #fff; cursor: pointer; font-weight: 600; flex: 1 1 0; min-width: 0; max-width: 50%; box-sizing: border-box;"\n              >\n                <i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem; font-size: 18px;">send</i>\n                Envoyer\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    ',document.body.appendChild(modal),modal}()),resetModal(),modal.style.display="flex",document.body.style.overflow="hidden"}function closeContactModal(){const modal=document.getElementById("contactMessageModal");modal&&(modal.style.display="none",document.body.style.overflow="",resetModal())}function init(){const checkContactPage=setInterval(()=>{document.querySelector(".contact-list")&&(clearInterval(checkContactPage),addContactButton())},100),observer=new MutationObserver(()=>{addContactButton()}),contactSection=document.getElementById("contact");contactSection&&observer.observe(contactSection,{childList:!0,subtree:!0}),document.addEventListener("click",e=>{("contactMessageClose"===e.target.id||e.target.closest("#contactMessageClose"))&&closeContactModal(),("contactMessageCancel"===e.target.id||e.target.closest("#contactMessageCancel"))&&closeContactModal()}),document.addEventListener("click",e=>{const modal=document.getElementById("contactMessageModal");modal&&e.target===modal&&closeContactModal()}),document.addEventListener("submit",async e=>{if("contactMessageForm"===e.target.id){e.preventDefault();const telegramUsername=document.getElementById("contactTelegramUsername").value,message=document.getElementById("contactMessageText").value;if(!telegramUsername||!message)return void alert("Veuillez remplir tous les champs");const submitBtn=document.getElementById("contactMessageSubmit");submitBtn&&(submitBtn.disabled=!0,submitBtn.textContent="Envoi..."),await async function(telegramUsername,message){try{const backendUrl=window.location.origin,response=await fetch(`${backendUrl}/api/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({telegramUsername:telegramUsername.trim(),message:message.trim()})}),data=await response.json();if(!response.ok||!data.success)throw new Error(data.error||"Erreur lors de l'envoi");!function(){const form=document.getElementById("contactMessageForm"),successDiv=document.getElementById("contactMessageSuccess");if(form&&successDiv){form.style.display="none",successDiv.style.display="block";const closeBtn=document.getElementById("contactMessageCloseAfterSuccess");closeBtn&&(closeBtn.onclick=()=>{closeContactModal()})}}()}catch(error){console.error("Erreur envoi message:",error),window.AdminUtils&&window.AdminUtils.showToast?window.AdminUtils.showToast("Erreur lors de l'envoi du message","error"):alert("Erreur lors de l'envoi du message. Veuillez réessayer.")}}(telegramUsername,message),submitBtn&&(submitBtn.disabled=!1,submitBtn.innerHTML='<i class="material-icons" style="vertical-align: middle; margin-right: 0.5rem; font-size: 18px;">send</i> Envoyer')}})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init()}();