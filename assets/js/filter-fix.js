!function(){"use strict";let filterListenersAttached=!1,applyFiltersFn=null;function attachFilterListeners(){const filterCategory=document.getElementById("filterCategory"),filterFarm=document.getElementById("filterFarm");return!(!filterCategory&&!filterFarm||(filterCategory&&filterCategory._filterListener&&filterCategory.removeEventListener("change",filterCategory._filterListener),filterFarm&&filterFarm._filterListener&&filterFarm.removeEventListener("change",filterFarm._filterListener),applyFiltersFn=function(){const filterCategoryEl=document.getElementById("filterCategory"),filterFarmEl=document.getElementById("filterFarm"),categoryValue=filterCategoryEl?filterCategoryEl.value:"tous",farmValue=filterFarmEl?filterFarmEl.value:"",productsStr=localStorage.getItem("site_products");if(productsStr)try{const products=JSON.parse(productsStr),normalized=window.normalizeProducts?window.normalizeProducts(products):products;let filtered="tous"===categoryValue||""===categoryValue?normalized:normalized.filter(p=>(p.category||"")===categoryValue);farmValue&&""!==farmValue.trim()&&(filtered=filtered.filter(p=>(p.farm||"")===farmValue)),window.renderProducts?window.renderProducts(filtered):console.warn("window.renderProducts n'est pas disponible")}catch(error){console.error("Erreur lors du filtrage des produits:",error)}else console.warn("Aucun produit trouvé dans localStorage")},filterCategory&&(filterCategory._filterListener=applyFiltersFn,filterCategory.addEventListener("change",applyFiltersFn)),filterFarm&&(filterFarm._filterListener=applyFiltersFn,filterFarm.addEventListener("change",applyFiltersFn)),filterListenersAttached=!0,0))}function initFilters(){filterListenersAttached||attachFilterListeners()}const observer=new MutationObserver(function(mutations){let shouldReattach=!1;mutations.forEach(function(mutation){if("childList"===mutation.type||"attributes"===mutation.type){const filterCategory=document.getElementById("filterCategory"),filterFarm=document.getElementById("filterFarm");(filterCategory||filterFarm)&&(filterCategory&&!filterCategory._filterListener&&(shouldReattach=!0),filterFarm&&!filterFarm._filterListener&&(shouldReattach=!0))}}),shouldReattach&&attachFilterListeners()});if("loading"===document.readyState)document.addEventListener("DOMContentLoaded",function(){initFilters();const filterPanel=document.getElementById("filterPanel");filterPanel&&observer.observe(filterPanel,{childList:!0,subtree:!0,attributes:!0})});else{initFilters();const filterPanel=document.getElementById("filterPanel");filterPanel&&observer.observe(filterPanel,{childList:!0,subtree:!0,attributes:!0})}function setupResetButton(){const resetBtn=document.getElementById("filterReset");resetBtn&&!resetBtn._resetListener&&(resetBtn._resetListener=function(){const filterCategory=document.getElementById("filterCategory"),filterFarm=document.getElementById("filterFarm");filterCategory&&(filterCategory.value="tous"),filterFarm&&(filterFarm.value=""),applyFiltersFn&&applyFiltersFn()},resetBtn.addEventListener("click",resetBtn._resetListener))}window.addEventListener("adminDataUpdated",function(e){"categories"!==e.detail.key&&"farms"!==e.detail.key||setTimeout(function(){attachFilterListeners()},100)}),window.addEventListener("storage",function(e){"site_categories"!==e.key&&"site_farms"!==e.key||setTimeout(function(){attachFilterListeners()},100)}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",setupResetButton):setupResetButton();const resetObserver=new MutationObserver(function(){setupResetButton()}),filterPanel=document.getElementById("filterPanel");filterPanel&&resetObserver.observe(filterPanel,{childList:!0,subtree:!0}),console.log("✅ Système de filtres catégorie/farm initialisé")}();